{
  # ACME settings and port configuration
  email admin@dev.deploy
  
  http_port 80
  https_port 443
  
  # Enable HTTP/3 support with fallback protocols
  servers {
    protocols h1 h2 h3
  }
  
  # On-demand TLS for SaaS applications (if enabled)
  
  
  log {
    output file /var/log/caddy/access.log
    format json
  }
}

# Root domain configuration
dev.deploy {
  # Enable advanced compression
  encode {
    gzip 6
    zstd
  }
  
  # Security headers
  header {
    # Remove server info
    -Server
    # XSS Protection
    X-Content-Type-Options nosniff
    X-Frame-Options DENY
    X-XSS-Protection "1; mode=block"
    # HSTS
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  }
  
  # Proxy requests to DialUpDeploy server with health monitoring
  reverse_proxy localhost:3000 {
    health_uri /health
    health_interval 30s
    health_timeout 5s
    flush_interval -1
  }
}


# Subdomain configurations

default.dev.deploy {
  # Enable advanced compression
  encode {
    gzip 6
    zstd
  }
  
  # Security headers
  header {
    -Server
    X-Content-Type-Options nosniff
    X-Frame-Options SAMEORIGIN
    X-XSS-Protection "1; mode=block"
  }
  
  # Proxy requests with forwarded headers for site routing
  reverse_proxy localhost:3000 {
    header_up Host {host}
    header_up X-Real-IP {remote}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Proto {scheme}
  }
}

.deploy.dev.deploy {
  # Enable advanced compression
  encode {
    gzip 6
    zstd
  }
  
  # Security headers
  header {
    -Server
    X-Content-Type-Options nosniff
    X-Frame-Options SAMEORIGIN
    X-XSS-Protection "1; mode=block"
  }
  
  # Proxy requests with forwarded headers for site routing
  reverse_proxy localhost:3000 {
    header_up Host {host}
    header_up X-Real-IP {remote}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Proto {scheme}
  }
}

logs.dev.deploy {
  # Enable advanced compression
  encode {
    gzip 6
    zstd
  }
  
  # Security headers
  header {
    -Server
    X-Content-Type-Options nosniff
    X-Frame-Options SAMEORIGIN
    X-XSS-Protection "1; mode=block"
  }
  
  # Proxy requests with forwarded headers for site routing
  reverse_proxy localhost:3000 {
    header_up Host {host}
    header_up X-Real-IP {remote}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Proto {scheme}
  }
}
